<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>购物流程_京东网上商城-综合网购首选</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="__ROOT__/public/themes/jindong/stye1024.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="__ROOT__/public/js/shopping_flow.js"></script>
    <script type="text/javascript" src="__ROOT__/publicjs/showdiv.js"></script>
    <script type="text/javascript">
	var process_request = "正在处理您的请求...";
	var username_empty = "- 用户名不能为空。";
	var username_shorter = "- 用户名长度不能少于 3 个字符。";
	var username_invalid = "- 用户名只能是由字母数字以及下划线组成。";
	var password_empty = "- 登录密码不能为空。";
	var password_shorter = "- 登录密码不能少于 6 个字符。";
	var confirm_password_invalid = "- 两次输入密码不一致";
	var email_empty = "- Email 为空";
	var email_invalid = "- Email 不是合法的地址";
	var agreement = "- 您没有接受协议";
	var msn_invalid = "- msn地址不是一个有效的邮件地址";
	var qq_invalid = "- QQ号码不是一个有效的号码";
	var home_phone_invalid = "- 家庭电话不是一个有效号码";
	var office_phone_invalid = "- 办公电话不是一个有效号码";
	var mobile_phone_invalid = "- 手机号码不是一个有效号码";
	var msg_un_blank = "* 用户名不能为空";
	var msg_un_length = "* 用户名最长不得超过7个汉字";
	var msg_un_format = "* 用户名含有非法字符";
	var msg_un_registered = "* 用户名已经存在,请重新输入";
	var msg_can_rg = "* 可以注册";
	var msg_email_blank = "* 邮件地址不能为空";
	var msg_email_registered = "* 邮箱已存在,请重新输入";
	var msg_email_format = "* 邮件地址不合法";
	var msg_blank = "不能为空";
	var no_select_question = "- 您没有完成密码提示问题的操作";
	var passwd_balnk = "- 密码中不能包含空格";
	var username_exist = "用户名 %s 已经存在";
	var compare_no_goods = "您没有选定任何需要比较的商品或者比较的商品数少于 2 个。";
	var btn_buy = "购买";
	var is_cancel = "取消";
	var select_spe = "请选择商品属性";
	var user_name_empty = "请输入您的用户名！";
    var email_address_empty = "请输入您的电子邮件地址！";
    var email_address_error = "您输入的电子邮件地址格式不正确！";
    var new_password_empty = "请输入您的新密码！";
    var confirm_password_empty = "请输入您的确认密码！";
    var both_password_error = "您两次输入的密码不一致！";
    var show_div_text = "请点击更新购物车按钮";
    var show_div_exit = "关闭";
    function collect_to_flow(goodsId)
    {
      var goods        = new Object();
      var spec_arr     = new Array();
      var fittings_arr = new Array();
      var number       = 1;
      goods.spec     = spec_arr;
      goods.goods_id = goodsId;
      goods.number   = number;
      goods.parent   = 0;
      Ajax.call('flow.php?step=add_to_cart', 'goods=' + goods.toJSONString(), collect_to_flow_response, 'POST', 'JSON');
    }
    function collect_to_flow_response(result)
    {
      if (result.error > 0)
      {
        // 如果需要缺货登记，跳转
        if (result.error == 2)
        {
          if (confirm(result.message))
          {
            location.href = 'user.php?act=add_booking&id=' + result.goods_id;
          }
        }
        else if (result.error == 6)
        {
          openSpeDiv(result.message, result.goods_id);
        }
        else
        {
          alert(result.message);
        }
      }
      else
      {
        location.href = 'flow.php';
      }
    }


//删除单个商品
      function delBook(carId)
      {
        window.location = "__APP__/Action/delete/carId/"+carId;
      }
      //清空购物车
      function clearCar()
      {
        if(confirm("是否清空购物车？"))
        {
          window.location = "__APP__/Action/clear";
        }
      }
      //修改产品数量
      function changeCount(carId)
      {
        //要修改成的数量
        var goodsCount = $("#txt"+carId).val();
        //利用ajax修改数量
        $.ajax({
          type:"post",
          url:"__APP__/Action/change",
          data:"carId="+carId+"&goodsCount="+goodsCount,
          dataType:"json",
          success:function(re){
            var new_price = re.new_price;
            var totalPrice = re.totalPrice;
            $("#totalSpan").html(totalPrice);
            $("#td"+carId).html(new_price);
          }
        });
      }





	</script>
  </head>
  <body>
    <div id="container">
      
      <include file="Public:header" />
      
      <div class="p_w" style="clear:both; overflow:hidden"></div>
      <div id="urHere" class="globalModule">
        <h3><a href=".">首页</a> <code>&gt;</code> 购物流程</h3>
      </div>
      <div class="blank"></div>
      <div style="width:80%; margin:0 AUTO">
        <div class="flow_tou">
          <img  style="float:left"src="__ROOT__/public/themes/jindong/images/cart_001.gif" />
          <span> 购物满400元，部分地区免运费，<a href="#">详细了解>></a></span>
        </div>
        <div class="blank5"></div>
        <div class="flowBox_title">
          <dl></dl><dt>我挑选的商品</dt><dd></dd>
        </div>
        <div class="flowBox">
          <form id="formCart" name="formCart" method="post" action="__APP__/Cart/update">
            <table width="99%" align="center" border="0" cellpadding="5" cellspacing="1" bgcolor="#aacded">
              <tr>
                <th bgcolor="#ebf4fb">商品名称</th>
                <th bgcolor="#ebf4fb">属性</th>
                <th bgcolor="#ebf4fb">美智价</th>
                <th bgcolor="#ebf4fb">购买数量</th>
                <th bgcolor="#ebf4fb">小计</th>
                <th bgcolor="#ebf4fb">操作</th>
              </tr>
              <foreach name="carInfo" item="v">
              <tr>
                <td bgcolor="#ffffff" align="left">
                  <a href="__APP__/Goods/index" target="_blank"><img src="__ROOT__/public/images/201003/thumb_img/4759_thumb_G_1268730511818.jpg" border="0" title="完美搭配之夏秋装韩版磨破火辣牛仔小短裤" /></a><br />
                  <a href="__APP__/Goods/index" target="_blank" class="f6">{$v.goodstitle}</a>
                </td>
                <td bgcolor="#ffffff"></td>
                <td align="center" bgcolor="#ffffff">￥{$v.new_price}元</td>
                <td align="center" bgcolor="#ffffff">
                  <input type="text" name="goods_number[42]" id="txt{$v.carId}" value="{$v.goodsCount}" size="4" class="inputBg" style="text-align:center " onkeydown="showdiv(this)"/>
                </td>
                <td align="center" bgcolor="#ffffff" id="td{$v.carId}">{$v["new_price"],$v["goodsCount"]|sum}</td>
                <td align="center" bgcolor="#ffffff">
                  <a class="f6" onclick="delBook({$v.carId})">删除</a>
                </td>
              </tr>
              </foreach>
              <tr>
                <td colspan="7" align="right" bgcolor="#ebf4fb" style="color:#F00; font-weight:bold">
          &nbsp;&nbsp;&nbsp;所有商品总价为：<span id="totalSpan">{$carInfo|total}</span>￥
          &nbsp;&nbsp;&nbsp;          
                </td>
              </tr>
            </table>
            <input type="hidden" name="step" value="update_cart" />
            <table width="99%" align="center" border="0" cellpadding="5" cellspacing="0" bgcolor="#aacded">
              <tr>
                <td bgcolor="#ffffff" style="padding:20px;0">
                  <a href="__APP__/Index/index"><img title="123" style="vertical-align:middle;" src="__ROOT__/public/themes/jindong/images/jixubuy.gif" /></a>&nbsp;&nbsp;&nbsp;&nbsp;
                  <input onclick="clearCar()" style="vertical-align:middle;"  type="button" value="" class="clear_car" />&nbsp;&nbsp;&nbsp;&nbsp;
                  <input style="vertical-align:middle;" name="submit" type="submit" class="gengxin_car" value="" />
                </td>
                <td bgcolor="#ffffff" align="right" style="padding:20px;0"><a href="__APP__/Cart/flow"><img title="456" src="__ROOT__/public/themes/jindong/images/checkout.gif" alt="checkout" /></a></td>
              </tr>
            </table>
          </form>
        </div>
        <div class="blank"></div>
        <div class="blank5"></div>
      </div>
      <div class="blank"></div>
      <div class="blank"></div>
      
      <include file="Public:footer" />
    
    </div>
  </body>
</html>